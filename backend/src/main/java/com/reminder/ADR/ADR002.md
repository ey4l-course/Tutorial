# Architecture Decision Record (ADR)

## Title
Role-Based Access Control (RBAC) and Feature Scope for User and Admin Endpoints in Budget Management App

## Status
Accepted

## Context
This personal budget management application currently supports single-user transaction management and basic user registration/login functionality. To expand the app's capabilities, clear role-based access control and API feature scoping are required to manage users securely and efficiently.

## Decision

### Role Definitions and Access Levels

1. **User-level Access (Self-Service)**
    - View personal profile
    - Edit personal information
    - Reset password
    - Delete own account  
      These operations are limited to the authenticated user and allow full control over their own account without administrative rights.

2. **Admin-level Access**
    - View all users
    - Delete users
    - Edit user details including roles  
      Admins have elevated privileges to manage user accounts and roles. Access to these endpoints requires proper authorization checks.

3. **App-level Access (Automated/System User)**
    - Export User CRM database to CSV  
      This access is reserved for automated processes or system-level users. Exporting data is not part of admin privileges but handled by a dedicated application user role.

### Branching Strategy for New Features

- User self-service features (profile view, edit, reset password, delete account) should be developed under a single feature branch, e.g., `feature/user-self-service`.
- Admin features (user management, role editing) should reside in separate branches such as `feature/admin-user-management`.
- App-level features (e.g., data export) can be developed under dedicated branches like `feature/app-export`.

### Security Enforcement

- Use Spring Security (or equivalent) to enforce RBAC at the controller/service layer based on authenticated user roles.
- Authorization filters will ensure requests match the required role before proceeding.
- Centralized logging with `RequestContextDTO` will track user actions and outcomes across roles for auditability.

## Consequences

- Clear separation of concerns and feature scope improves maintainability and testing.
- RBAC enforcement reduces risk of unauthorized access or privilege escalation.
- Branching strategy simplifies code reviews and merges for distinct roles/features.
- Logs enriched with user context support troubleshooting and auditing.

## References

- Current project discussions on role and feature scope (2025-08-01)
- Spring Security documentation on method-level security and role hierarchy

