# Architectural Decision Record: Centralized Request Logging with RequestContextDTO

## Status
Accepted

## Context
Prior to this change, request and response logging was decentralized and inconsistent, often lacking critical context like client IP, user-agent, route, and response status.

This caused challenges with:
- Debugging production issues
- Tracking request flow through the app
- Understanding user behavior or attack vectors
- Correlating logs across layers (filter → controller)

## Decision
Introduce a centralized logging mechanism using a `RequestContextDTO` that is:
- Created in a `OncePerRequestFilter`
- Populated with request metadata (method, URI, IP, user-agent)
- Stored as a request-scoped attribute
- Mutated by downstream layers (e.g., controllers) to set userName, outcome, etc.
- Logged once in a `finally` block of the filter, after the full request lifecycle

Controllers should no longer call `logUtil.logRequest()` directly except in special cases. Instead, they should enrich the `contextDTO` with semantic outcomes (`[SUCCESS]`, `[REJECTED]`, etc.), which the filter will serialize and send to the logs.

## Consequences
### Pros
- Consistent structured logs for all requests
- Cleaner controller logic
- Better separation of concerns
- Easier SIEM/ELK pipeline parsing
- Reduces repetitive logging code

### Cons
- Adds slight complexity in request-scoped data sharing
- Requires discipline to set `outcome` in all code paths (especially error branches)

## Alternatives Considered
- Manual logging per controller/method — rejected for verbosity and inconsistency
- Using AOP — not ideal for access to HttpServletRequest or early response rejection in filters

## Notes
- Logs are structured with Jackson `ObjectMapper`, with `JavaTimeModule` enabled via configuration.
- Exceptions are still logged explicitly where appropriate using `logUtil.error` or `logUtil.securityLog`.

## Related
- `JwtAuthenticationFilter.java`
- `RequestContextDTO.java`
- `LogUtil.java`
- `JacksonConfig.java`
